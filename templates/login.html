{% extends 'layout.html' %}
{% block links %}
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
{% endblock %}
{% block scripts %}
<script type="text/javascript"> 
function reviewform() {
  var param = "0743484355";
  var url = '/api/submit_review?isbn='+param;
  var form = new FormData(document.getElementById("submitreview"));  
  var review = form.get("review")
  var rating = form.get("rating")
  requestobj = {}
  requestobj['rating'] = rating
  requestobj['review'] =review
  requestobj['username'] =document.getElementById("username").innerText

  var json = JSON.stringify(requestobj);
  var http = new XMLHttpRequest();
  http.open("POST", url);
  http.setRequestHeader('Content-Type','application/json');

  http.send(json);
  http.onload = function () {
  var data = JSON.parse(http.responseText);
  if (http.status == "200") {
    var html = data;
    document.getElementById("review").innerHTML=html;
   
  }
  else {
    if (http.status == 404) {
      var errormessage = "<br><br><h3 style = 'text-align:center'>No Book Results found</h3>"
    } else if (http.status == 500) {
      var errormessage = "<br><br><h3 style = 'text-align:center'>Please Try again after some time</h3>"
    }else if (http.status == 409) {
      var errormessage = "<br><br><h3 style = 'text-align:center'>Error:user had already given rating</h3>"
    }
    // console.log(errormessage)
    // console.log(data)
    document.getElementById("review").innerHTML=errormessage;
  }
}
}
</script>
{% endblock %}
{% block body %}  
    <nav class="navbar navbar-light navbar-fixed-top" style="background-color: #e3f2fd;" >
            <a class="navbar-brand" id ="username" > {{username}}</a>
            <form class="form-inline">
              
              <button class="btn btn-outline-success my-2 my-sm-0" type="submit" formmethod="GET" formaction=" {{url_for ('logout'
              )}}">Logout</button>
            </form>
          </nav>
     <div style="display:{{property}}" class="container">
                    <form class="example" id = "submitreview" onsubmit="event.preventDefault(); reviewform()">
                        <div class="rate">

                            <h4 class="starhead">Rating</h4>

                            <input type="radio" id="star5" name="rating" value="5" />
                            <label for="star5" title="text">5 stars</label>
                            <input type="radio" id="star4" name="rating" value="4" />
                            <label for="star4" title="text">4 stars</label>
                            <input type="radio" id="star3" name="rating" value="3" />
                            <label for="star3" title="text">3 stars</label>
                            <input type="radio" id="star2" name="rating" value="2" />
                            <label for="star2" title="text">2 stars</label>
                            <input type="radio" id="star1" name="rating" value="1" />
                            <label for="star1" title="text">1 star</label>

                        </div>

                        <div id="text" class="row">
                            <div class="col-75">
                                <textarea id="Review" name="review" placeholder="Write your review.."
                                    style="height:200px"></textarea>
                            </div>
                        </div>

                        <div class="row">
                            <input class="bttn" type="submit" value="Submit">
                        </div>

                    </form>                
<div id = "review"></div>
{% endblock %}